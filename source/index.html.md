---
title: OmniBOLT API Reference

language_tabs: # must be one of https://git.io/vQNgJ
  - shell
  - javascript
  - golang

toc_footers:
  - <a href='https://github.com/omnilaboratory/obd'>Join our dev community</a>
  - <a href='https://github.com/omnilaboratory/OmniBOLT-spec'>Help in OmniBOLT specification</a>
  - <a href='https://github.com/lord/slate'>Documentation Powered by Slate</a>

 
includes:
  - fund_channel
  - deposit_tokens
  - payments_in_channel
  - htlc
  - atomic_swap
  - query
  - grpc
  
search: true
---

<!-- # OmniBOLT Daemon Websocket Messages Reference -->
# OBD Websocket Reference

Welcome to the Websocket API reference documentation for OmniBOLT Daemon (OBD), the daemon that communicates with light clients written in any program languages that support websocket connection, such as javascript, golang, shell or even C/C++. OBD runs as an independent process connecting to a full node of OmniCore(version 0.18 or later), which provides the on chain settlement service for OmniBOLT. And current OBD implementation is deeply binded to OmniCore. 

We assume you have already gone through our [installation instruction](https://github.com/omnilaboratory/obd#installation), so that you are familar with:

 * Pulling source code and compile to get obdserver;  
 * Configuring OmniCore node for OBD;  
 * Connecting OBD with Omnicore correctly;  
 * Using [GUI tool](https://github.com/omnilaboratory/DebuggingTool) to test all functions of OBD, OR
 * Using a simple web based [websocket client](https://chrome.google.com/webstore/detail/websocket-test-client/fgponpodhbmadfljofbimhhlengambbn?hl=en) for Chrome to do experiments;  
 * OBD responses you correctly;  

For kernel developers in our community, the above steps are the easiest way to get started. Just run the [GUI tool](https://github.com/omnilaboratory/DebuggingTool) and open [OmniBOLT Daemon](https://github.com/omnilaboratory/obd#step-4-test-channel-operations-using-websocket-testing-tool) project with your favorit golang editor, run OBD in debug mode, setup break points, and send messages from GUI tool. You may intercept the messages and track message flows of OBD kernel.


[Client JS SDK](https://github.com/omnilaboratory/DebuggingTool/tree/master/sdk) is also released with the GUI tool. This SDK implements APIs in this document, especially the internal HD functions managing pub/priv keys generation. This SDK and is for wallet developers to easily integrate. Also it helps developers automatically fill in the arguments which is hardly to be manually finished.



# wsWallet

Wallet is the first place that a client begin to work with an obd instance. User can initiate a local obd instance or connect to a remote one. The first step is to generate mnemonic code to identify yourself in the network using genMnemonic. Once the code is obtained by the user, then channel addresses, pub/priv key pairs will all be generated by it. The wallet is created. 


## genMnemonic

### Simple Type -102004 Protocol


### Mode 1 local OBD: 
Type -102004 Protocol is used to sign up a new user by hirarchecal deterministic wallet system integrated in OBD.
OBD returns mnemonic words to the client who signs up, and create a new user by the hash of the mnemonic words as the UserID.


### Mode 2 remote OBD that is not trusted (currently using as a SDK function): 
In this mode, this Protocol requires to generate mnemonic words using BIP32 on local device. Clients, e.g wallets, interacting with obd shall implement this HD mechanism for security guarantees. Mnemonic words shall be kept in a local safe place, and never be shared with any OBD instances.

<aside class="warning">
Don't trust any remote OBD which generates mnemonic words for you. We strongly suggest user to use our js sdk to generate mnemonic words locally, and keep it in a safe place.
</aside>

<!-- Comment by Kevin 2019-11-29
This endpoint manages users created by an OBD instance. Here we use Alice and Bob for testing purpose. The complete hirarchecal deterministic wallet system will be integrated soon, functions being including but not limited to: generat user mnemonic words, public/private key paires, PIN code, restore account. -->

### Websocket Request: Message Type -102004

<!-- right -->
> GenSeed request:

```json
{
	"type":-102004
}
```

<!-- center -->
This request has no parameters.

### Websocket Response: Message Type -102004

<!-- right -->
> Client SDK returns:

```json
{
	"type":-102004,
	"status":true,
	"from":"c2215a60-8b81-439f-8cb3-11ba51691076",
	"to":"c2215a60-8b81-439f-8cb3-11ba51691076",
	"result":"two ribbon knee leaf easy pottery hobby pony mule test bridge liar sand mirror decline gasp focus this park undo rough cricket portion ignore"
}
```

<!-- center -->
Parameter | default | placement | Description
--------- | ------- | --------- | ------------
status    | ------- |   body    | true or false.
from      | ------- |   body    | socket id generated when establishing a websocket connection.
to        | ------- |   body    | socket id generated when establishing a websocket connection.
result    | ------- |   body    | mnemonic words.


## logIn

### Simple Type -102001 Protocol

Type -102001 Protocol is used to login to OBD.

### Websocket Request: Message Type -102001

> Login request:

```json
{
    "type":1,
    "data":{
        "mnemonic":"< mnemonic words generated by obd or client library >"
    }
}
```

Parameter | default | placement | Description
--------- | ------- | --------- | ------------
mnemonic  | ------- |   data    | mnemonic words generated by OBD

### Websocket Response: Message Type -102001

> OBD Responses:

```json
{
    "type":-102001,
    "status":true,
    "from":"7da8d2441e0ad67040a274902f1965ee1a5c3fdd86f1ddc3280eda5230e006f2",
    "to":"all",
    "result":"7da8d2441e0ad67040a274902f1965ee1a5c3fdd86f1ddc3280eda5230e006f2 login"
}
```

Parameter | default | placement | Description
--------- | ------- | --------- | ------------
status    | ------- |   body    | true or false
from      | ------- |   body    | A SHA256 string of mnemonic words as the peer id
to        | ------- |   body    | to whom should know the login of this peer
result    | ------- |   body    | response data from OBD


<!-- ## logOut

### Simple Type -102002 Protocol

Log out. -->

## connectPeer 

### Simple Type -102003

Establish a p2p connection with a remote OBD.

### Websocket Request: Message Type -102003

> Request: 

```json
{
	"type":-102003,
	"data":{
		"remote_node_address":"/ip4/62.234.216.108/tcp/3001/p2p/Qmdqwooq9Ab7Bry1NT3bgbrj2i57ugEKZwoZTGPLiKnMF8"
	}
}
```


Parameter | default | placement | Description
--------- | ------- | --------- | ------------
remote_node_address      | ------- |   body    |  node address of the OBD.


## connectToServer 

Connect to an OBD.

> Request: 

```json
{
	"data":{
		"obd_address":"ws://62.234.216.108:60020/wstest"
	}
}
```


Parameter | default | placement | Description
--------- | ------- | --------- | ------------
obd_address      | ------- |   body    |  an OBD address.


## genAddressFromMnemonic 

### Simple Type -103000 Protocol (currently using as a SDK function)

Type -103000 Protocol generates a new address from mnemonic words. This message requires to generate address on local device from mnemonic words using BIP32. Clients interacting with obd, e.g wallets, shall implement this HD mechanism for security guarantees. Mnemonic words shall be kept in a safe place, and never be shared  with any obd instances.  

### Request: Message Type -103000

> Requests:

```json
{
	"type": -103000
}
```

This message has no arguments.

### Response: Message Type -103000

> Responses:

```json
{
    "type":-103000,
    "status":true,
    "from":"39e8b1f3e7aec51a368d70eac6d47195099e55c6963d38bcd729b22190dcdae0",
    "to":"39e8b1f3e7aec51a368d70eac6d47195099e55c6963d38bcd729b22190dcdae0",
    "result":{
        "address":"mfstT4mnj9AsT6XRKf6MWbFC2Ae99oMJf6",
        "index":0,
        "private_key":"0c379ade77ceefbc2b54ee76bab7d483a4dd37ebb8a3fc6f91ae6d01e2084bc5",
        "pub_key":"03c285a23081ea778b38e4fa4e870a9a2c0de2b526f6c915a62091bbe0e5b2c50d",
        "wif":"cMzT53SEiF1PkoJaxp44pA8yhLFkqbRc9AWRZDyBTmHgnipdJ8zs"
    }
}
```

Parameter | default | placement | Description
--------- | ------- | --------- | ------------
status    | ------- |   body    | true or false
from	  | ------- |   body    | sender
to        | ------- |   body    | receiever
address   | ------- |   result  | The newly generated wallet address
index     | ------- |   result  | number of generated sort
private_key   | ------- |   result  | private key of address
pub_key   | ------- |   result  | public key of address
wif       | ------- |   result  | other format private key of address


<!-- currently not used, 2020-06-17 -->
<!-- 
## getAddressInfo

### Simple Type -201 Protocol

Type -201 Protocol is used to get detail info of a address 
generated by mnemonic words.

### Websocket Request: Message Type -201

> Request:

```json
{
    "type":-201,
    "data":0
}
```

Parameter | default | placement | Description
--------- | ------- | --------- | ------------
index     | ------- |   data    | number of generated sort with mnemonic words

### Websocket Response: Message Type -201

> OBD Responses:

```json
{
    "type":-201,
    "status":true,
    "from":"39e8b1f3e7aec51a368d70eac6d47195099e55c6963d38bcd729b22190dcdae0",
    "to":"39e8b1f3e7aec51a368d70eac6d47195099e55c6963d38bcd729b22190dcdae0",
    "result":{
        "address":"mfstT4mnj9AsT6XRKf6MWbFC2Ae99oMJf6",
        "index":0,
        "private_key":"0c379ade77ceefbc2b54ee76bab7d483a4dd37ebb8a3fc6f91ae6d01e2084bc5",
        "pub_key":"03c285a23081ea778b38e4fa4e870a9a2c0de2b526f6c915a62091bbe0e5b2c50d",
        "wif":"cMzT53SEiF1PkoJaxp44pA8yhLFkqbRc9AWRZDyBTmHgnipdJ8zs"
    }
}
```

Parameter | default | placement | Description
--------- | ------- | --------- | ------------
status    | ------- |   body    | true or false
from	  | ------- |   body    | sender
to        | ------- |   body    | receiever
address   | ------- |   result  | The newly generated wallet address
index     | ------- |   result  | number of generated sort
private_key   | ------- |   result  | private key of address
pub_key   | ------- |   result  | public key of address
wif       | ------- |   result  | other format private key of address

-->


# Basic Lightning Network Operations

<!-- # create channel -->
## openChannel

### Simple Type -100032 Protocol

Type -100032 Protocol is used to request to create a channel with someone else(Bob). 

Alice sends request to her OBD instance, her OBD helps her complete the message, and routes her request to Bob's OBD for creating a channel between them. 

### Websocket Request: Message Type -100032 

> Request:
 
```json
{
    "type":-100032,
    "recipient_node_peer_id":"QmVEoTmyofsbEnsoFwQXHngafECHJuVfEgGyb2bZtyiont",
    "recipient_user_peer_id":"39e8b1f3e7aec51a368d70eac6d47195099e55c6963d38bcd729b22190dcdae0",
    "data":{
		"funding_pubkey":"02c57b02d24356e1d31d34d2e3a09f7d68a4bdec6c0556595bb6391ce5d6d4fc66",
		"is_private":false
    }
}
```

Parameter | default | placement | Description
--------- | ------- | --------- | ------------
recipient_node_peer_id | ------- |   body    | peer id of the obd node where the fundee logged in.
recipient_user_peer_id | ------- |   body    | the user id of the fundee.
funding pubkey    | ------- |   data    | public key of funder, who wish to deposite BTC and other tokens to the channel
is_private              | ------- |   data    | true to private channel or false to open channel.
 

### Websocket Response: Message Type -100032 

> OBD Response:

```json
{
	"type":-100032,
	"status":true,
	"from":"<user_id>",
	"to":"<user_id>",
	"result":
	{
		"chain_hash":"1EXoDusjGwvnjZUyKkxZ4UHEf77z6A5S4P",
		"channel_reserve_satoshis":0,
		"delayed_payment_base_point":"",
		"dust_limit_satoshis":0,
		"fee_rate_per_kw":0,
		"funding_address":"mx4TDCXP2DedxcuA8RXaQ6c4q2GKAimUPs",
		"funding_pubkey":"021d475729c52f86df24b36aa231945bd090f9c23ccbfb91e4ade6813b2419d32d",
		"funding_satoshis":0,
		"htlc_base_point":"",
		"htlc_minimum_msat":0,
		"max_accepted_htlcs":0,
		"max_htlc_value_in_flight_msat":0,
		"payment_base_point":"",
		"push_msat":0,
		"revocation_base_point":"",
		"temporary_channel_id":"38e41ef5ba61c11642b2fa3ea93e8026ab7b057b06b64215f255669acf8dc0ef",
		"to_self_delay":0
	}
}
```

Parameter | default | placement | Description
--------- | ------- | --------- | ------------
status    | ------- |    body   | true or false
from      | ------- |    body   | peer id of funder
to        | ------- |    body   | peer id of fundee
chain_hash | ------- |  result | identify the public chain. Default is OmniLayer's address: 1EXoDusjGwvnjZUyKkxZ4UHEf77z6A5S4P
channel_reserve_satoshis   | ------- |    result   | reserved satoshis in the channel
delayed_payment_base_point | ------- |    result   | 
dust_limit_satoshis        | ------- |    result   | 
fee_rate_per_kw            | ------- |    result   | 
funding_address            | ------- |    result   | Funder's address from where he send money to the channel
funding_pubkey             | ------- |    result   | public key of funder, who wish to deposite BTC and other tokens to the channel 
funding_satoshis           | ------- |    result   | 
htlc_base_point            | ------- |    result   | 
htlc_minimum_msat          | ------- |    result   | 
max_accepted_htlcs         | ------- |    result   | 
max_htlc_value_in_flight_msat      | ------- |    result   | 
payment_base_point                 | ------- |    result   | 
push_msat                          | ------- |    result   | 
revocation_base_point              | ------- |    result   | 
temporary_channel_id               | ------- |    result   | 
to_self_delay                      | ------- |    result   | 


## acceptChannel

### Simple Type -100033 Protocol
 

Bob replies to accept, his OBD completes his message and routes it back to Alice's OBD.
Then Alice sees the response of acceptance. 

### Websocket Request: Message Type -100033


> Request:
 
```json
{
    "type":-100033,
    "recipient_node_peer_id":"QmVEoTmyofsbEnsoFwQXHngafECHJuVfEgGyb2bZtyiont",
    "recipient_user_peer_id":"1f1dbb3518c1fb12f263d065c1d18576d13f88dff55bfc25ef52afaa2c97a5d2 ",
    "data":{
        "temporary_channel_id":"38e41ef5ba61c11642b2fa3ea93e8026ab7b057b06b64215f255669acf8dc0ef",
        "funding_pubkey":"028f49447e1a20d4211c8c621976cff3d2ae00d4af79be3e74e05f1ed4e23f319e",
        "approval":true
    }
}
```

Parameter | default | placement | Description
--------- | ------- | --------- | ------------
temporary_channel_id  | ------- |   data    | the temporary channel id, used before real funding completes.
funding pubkey        | ------- |   data    | public key of fundee(Bob), who wish to deposite BTC and other tokens to the channel. Current implementation of OBD supports one-way deposite. Fundee does not need to fund the channel.
approval              | ------- |   data    | true to accept or false to deny.
 
### Websocket Response: Message Type -100033

> OBD Responses:

```json
{
	"type":-100033,
	"status":true,
	"from":"<user_id>",
	"to":"<user_id>",
	"result":
	{
		"accept_at":"2019-09-21T00:06:48.634265+08:00",
		"address_a":"mx4TDCXP2DedxcuA8RXaQ6c4q2GKAimUPs",
		"address_b":"myHRPQWTQ1yYbj7vr7raBW59CTeAFEsUXY",
		"chain_hash":"1EXoDusjGwvnjZUyKkxZ4UHEf77z6A5S4P",
		"channel_address":"2N1DFjaE4yCcECdFwgLQcLmNrLV5zetgQtE",
		"channel_address_redeem_script":"5221021d475729c52f86df24b36aa231945bd090f9c23ccbfb91e4ade6813b2419d32d2103efd8923f1829ece87202892d31cd75c20b7a7b5adf888f7ba04fa2c1bc931ce952ae",
		"channel_address_script_pub_key":"a9145761a1d45b8a6e7caa10a4bcecca97630c67af4687",
		"channel_id":"",
		"channel_reserve_satoshis":0,
		"close_at":"0001-01-01T00:00:00Z",
		"create_at":"2019-09-21T00:05:25.667117+08:00",
		"create_by":"alice",
		"curr_state":20,
		"delayed_payment_base_point":"",
		"dust_limit_satoshis":0,
		"fee_rate_per_kw":0,
		"funding_address":"mx4TDCXP2DedxcuA8RXaQ6c4q2GKAimUPs",
		"funding_pubkey":"021d475729c52f86df24b36aa231945bd090f9c23ccbfb91e4ade6813b2419d32d",
		"funding_satoshis":0,
		"htlc_base_point":"",
		"htlc_minimum_msat":0,
		"id":2,
		"max_accepted_htlcs":0,
		"max_htlc_value_in_flight_msat":0,
		"payment_base_point":"",
		"peer_id_a":"alice",
		"peer_id_b":"bob",
		"pub_key_a":"021d475729c52f86df24b36aa231945bd090f9c23ccbfb91e4ade6813b2419d32d",
		"pub_key_b":"03efd8923f1829ece87202892d31cd75c20b7a7b5adf888f7ba04fa2c1bc931ce9",
		"push_msat":0,
		"revocation_base_point":"",
		"temporary_channel_id":"38e41ef5ba61c11642b2fa3ea93e8026ab7b057b06b64215f255669acf8dc0ef",
		"to_self_delay":0
	}
}
```

Parameter | default | placement | Description
--------- | ------- | --------- | ------------
status    | ------- |    body   | true or false
from      | ------- |    body   | peer id of funder
to        | ------- |    body   | peer id of fundee
accept_at | ------- |    result   | time of acceptance
address_a | ------- |    result   | address of Alice
address_b | ------- |    result   | address of Bob
chain_hash | ------- |   result   | identify the public chain. Default is OmniLayer's address: 1EXoDusjGwvnjZUyKkxZ4UHEf77z6A5S4P
channel_address                | ------- |    result   | the p2whk address of the channel
channel_address_redeem_script  | ------- |    result   | redeem script of the multi-sig address
channel_address_script_pub_key | ------- |    result   | the script pubkey
channel_id                     | ------- |    result   | the global unique channel id
channel_reserve_satoshis       | ------- |    result   | reserved satoshis in the channel
close_at                       | ------- |    result   | close time
create_at                      | ------- |    result   | create time
create_by                      | ------- |    result   | the funder who created this channel. Alice in this case.
curr_state                     | ------- |    result   | 
delayed_payment_base_point | ------- |    result   | 
dust_limit_satoshis        | ------- |    result   | 
fee_rate_per_kw            | ------- |    result   | 
funding_address            | ------- |    result   | Funder's address from where he send money to the channel
funding_pubkey             | ------- |    result   | public key of funder, who wish to deposite BTC and other tokens to the channel 
funding_satoshis           | ------- |    result   | 
htlc_base_point            | ------- |    result   | 
htlc_minimum_msat          | ------- |    result   | 
max_accepted_htlcs         | ------- |    result   | 
max_htlc_value_in_flight_msat      | ------- |    result   | 
payment_base_point                 | ------- |    result   | 
peer_id_a                          | ------- |    result   | peer id of funder
peer_id_b                          | ------- |    result   | peer id of fundee
pub_key_a                          | ------- |    result   | public key of funder
pub_key_b                          | ------- |    result   | public key of fundee. Current OBD implementation does not requir fundee to deposit money to a channel.
push_msat                          | ------- |    result   | 
revocation_base_point              | ------- |    result   | 
temporary_channel_id               | ------- |    result   | 
to_self_delay                      | ------- |    result   | 
